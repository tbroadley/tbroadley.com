<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Gatekeepify</title>

    <link rel="stylesheet" href="index.css">

    <script>
      function render() {
        document.getElementById('button').style.display = 'inline';
        document.getElementById('url-button').style.display = 'inline';
        document.getElementById('snort').style.display = 'inline-block';
        document.getElementById('snort-label').style.display = 'inline';

        document.getElementById('button-copied').style.display = 'none';
        document.getElementById('url-button-copied').style.display = 'none';

        var input = document.getElementById('text').value;
        var trimmedInput = input.trim();
        var allCapsInput = trimmedInput.toUpperCase();
        var splitInput = allCapsInput.split(' ');
        var output = splitInput.join(' üëè ')

        if (document.getElementById('snort').checked && output !== '') {
          output += ' üò§';
        }

        document.getElementById('output').textContent = output;
      }

      window.onload = function() {
        textInput = document.getElementById('text');
        textInput.focus();
        textInput.addEventListener('input', render);

        document.getElementById('snort').addEventListener('change', render);

        var editButton = document.getElementById('edit-button');
        editButton.addEventListener('click', function() {
          document.getElementById('editor').style.display = 'block';
          document.getElementById('text').focus();
          editButton.style.display = 'none';
        });

        function getParameterByName(name, url) {
          if (!url) {
            url = window.location.href;
          }
          name = name.replace(/[\[\]]/g, "\\$&");
          var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
              results = regex.exec(url);
          if (!results) return null;
          if (!results[2]) return '';
          return decodeURIComponent(results[2].replace(/\+/g, " "));
        }

        var text = getParameterByName('text');
        var snortChecked = getParameterByName('snort');
        if (text) {
          textInput.value = text;
          document.getElementById('snort').checked = snortChecked === 'true';
          document.getElementById('editor').style.display = 'none';
          editButton.focus();
          render();
        }
      };
    </script>
  </head>
  <body>
    <div id="app">
      <p id="output"></p>
      <button type="button" id="edit-button">Edit</button>
      <div id="editor">
        <textarea id="text" rows="8" cols="80"></textarea>
        <div id="snort-div">
          <input type="checkbox" id="snort">
          <label for="snort" id="snort-label">üò§</label>
        </div>
        <div id="buttons">
          <div class="button-container">
            <button type="button" id="button" data-clipboard-target="#output">Copy result</button>
            <span id="button-copied" aria-role="presentation">Copied!</span>
          </div>
          <div class="button-container">
            <button type="button" id="url-button">Copy URL</button>
            <span id="url-button-copied" aria-role="presentation">Copied!</span>
          </div>
        </div>
      </div>
    </div>

    <script src="clipboard.min.js" charset="utf-8"></script>
    <script>
      function focusInput() {
        document.getElementById('text').focus();
      }

      var clipboard = new Clipboard('#button');
      clipboard.on('success', function() {
        focusInput();
        document.getElementById('button-copied').style.display = 'block';
        document.getElementById('url-button-copied').style.display = 'none';
      });
      clipboard.on('error', focusInput);

      var urlClipboard = new Clipboard('#url-button', {
        text: function() {
          var text = encodeURIComponent(document.getElementById('text').value.trim());
          return window.location.href.split('?')[0]
            + '?text=' + text
            + '&snort=' + document.getElementById('snort').checked;
        },
      });
      urlClipboard.on('success', function() {
        focusInput();
        document.getElementById('button-copied').style.display = 'none';
        document.getElementById('url-button-copied').style.display = 'block';
      });
      urlClipboard.on('error', focusInput);
    </script>
  </body>
</html>
